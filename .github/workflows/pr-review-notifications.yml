name: PR review Slack notification

on:
  pull_request:
    types:
      - review_requested

jobs:
  notify_reviewers:
    runs-on: ubuntu-latest
    steps:
      - name: Extract reviewer usernames
        id: reviewers
        run: |
          echo "REVIEWERS=$(echo '${{ toJson(github.event.pull_request.requested_reviewers) }}' | jq -r '.[].login' | tr '\n' ' ')" >> $GITHUB_ENV

      - name: Format reviewer list
        id: format_reviewers
        run: |
          REVIEWER_LIST=""
          for reviewer in ${{ env.REVIEWERS }}; do
            REVIEWER_LIST="${REVIEWER_LIST}${reviewer} "
          done
          echo "REVIEWER_LIST=$REVIEWER_LIST" >> $GITHUB_ENV

      - name: Send Slack notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_MESSAGE: |
            🚀 New PR in *${{ github.repository }}*!
            🏷️ Name: *${{ github.event.pull_request.title }}*
            🧑‍💻 Author: ${{ github.actor }}
            👥 Reviewers: ${{ env.REVIEWER_LIST }}
            🔗 <${{ github.event.pull_request.html_url }}|View PR>
          SLACK_COLOR: "#36a64f"
